# 功能清单、技术架构与部署说明

> 说明：当前仓库未检测到业务代码（仅有 `README.md`），本文件基于已提供业务需求与通用最佳实践生成的参考方案。待代码或技术栈确认后，可进行定制化补充与校准。

## 一、功能清单（按模块）

- **项目管理**
  - 新建/编辑/归档/复制项目，项目模板
  - 字段：项目名称、部门、状态、负责人、成员、计划开始时间、计划结束时间、依赖项、实际完成时间、用时、完成率、里程碑、备注、进度表
  - 里程碑管理：增删改查、状态流转、达成率统计
  - 依赖管理：跨任务/跨项目依赖，关键路径识别
  - 项目权限：项目级可见性、成员角色（Owner/PM/成员/访客）

- **任务与子任务管理**
  - 任务/子任务层级、检查项、标签、优先级、估时/实际用时
  - 指派负责人/协作成员，批量操作（分配、状态、标签）
  - 任务状态机：Backlog → ToDo → In Progress → Blocked → Review → Done/Cancelled
  - 附件、评论、@提及、引用、富文本描述
  - 导入/导出（CSV/Excel），模板化创建

- **进度与可视化**
  - 甘特图（项目/跨项目）、看板视图、列表视图、日历视图
  - 燃尽图/燃起图、里程碑路线图、关键路径视图
  - 资源负载/成员工作量可视化

- **预警与通知**
  - 预警规则：计划偏差、截止临近、依赖阻塞、长时间未更新、超时、低完成率
  - 通道：站内、邮件、IM（企业微信/钉钉/Slack/Teams）、短信（可选）
  - 升级策略：多级提醒、超时自动上报负责人/领导
  - 去重/退让策略：聚合相似告警、静默时段、频率限制

- **报表与分析**
  - 项目概览、按期率、延期分布、完成率、里程碑健康度
  - 成员/部门维度 KPI：任务吞吐、平均周期、在制品（WIP）
  - 自定义报表、指标看板、导出（PDF/Excel）

- **组织与权限**
  - 组织与部门：层级、项目按部门隔离
  - 角色与权限：系统管理员、领导、项目经理、成员、访客；细粒度操作权限
  - 审计：操作日志、变更历史、导出留痕

- **集成与自动化**
  - 单点登录（SSO/OIDC/SAML）、企业通讯录同步
  - 日历同步（Google/Microsoft/钉钉/企业微信日程）
  - Webhook、双向同步（可选：Jira/Asana/Trello 导入）
  - 自动化规则：触发器（事件/时间）+ 条件 + 动作（通知/字段变更/创建任务）

- **移动与国际化**
  - 响应式 Web；后续可扩展 iOS/Android
  - i18n（中/英），时区/日期格式自动适配

- **AI 增强（可选）**
  - 延期预测、风险评分、智能排期建议
  - 周报/项目总结自动生成，自然语言查询与看板解释
  - 任务拆分与优先级推荐，依赖风险洞察

---

## 二、参考技术架构

> 在未指定技术栈前，建议采用“前后端分离 + 事件驱动的模块化单体（可演进为微服务）”

- **前端**：React + TypeScript + Vite + Ant Design + React Query/RTK Query
- **后端**：NestJS（TypeScript）+ TypeORM/Prisma，REST/OpenAPI 3.1，Swagger 文档
- **数据库**：PostgreSQL（主从/读写分离可选），时序/统计辅助表
- **缓存**：Redis（会话、热点数据、分布式锁）
- **消息队列**：RabbitMQ（异步通知、告警扫描、报表生成）
- **全文检索**：Elasticsearch/OpenSearch（任务/评论搜索）
- **对象存储**：S3 兼容（MinIO/云厂商）
- **认证与组织**：Keycloak 或自研 OAuth2.1 + JWT + RBAC
- **可观测性**：Prometheus/Grafana、Loki/ELK、OpenTelemetry
- **错误监控**：Sentry
- **通知适配**：SMTP、Slack/Teams、企业微信/钉钉、SMS 网关

```mermaid
flowchart LR
  U[用户] -->|HTTPS| FE[前端(React)]
  FE -->|REST/GraphQL| API[后端 API (NestJS)]
  API -->|SQL| DB[(PostgreSQL)]
  API -->|Cache| R[(Redis)]
  API -->|Publish| MQ[(RabbitMQ)]
  W[异步Worker] -->|Consume| MQ
  W --> NOTI[通知适配器]
  NOTI --> EMAIL[SMTP]
  NOTI --> IM[IM/企业微信/钉钉/Slack]
  API --> OSS[(对象存储)]
  API --> SEARCH[(Elasticsearch)]
  API --> METRICS[(Prometheus)]
  API --> LOGS[(Loki/ELK)]
```

- **模块划分（后端）**
  - `identity`（用户/部门/角色）
  - `projects`（项目/里程碑/依赖）
  - `tasks`（任务/子任务/状态机/评论/附件）
  - `reports`（指标统计/可视化）
  - `alerts`（规则/告警/升级/去重）
  - `notifications`（渠道/模板/发送）
  - `integrations`（SSO/日历/Webhook/第三方）

---

## 三、部署说明

- **环境分层**：`dev`（本地） / `staging` / `prod`
- **配置管理**：环境变量（12-Factor），敏感信息由 Secret 管理（Vault/K8s Secret）

### 3.1 本地开发（示例）

- 先决条件：Node.js 20+、Docker、Docker Compose、PostgreSQL 客户端
- 步骤：
  - 克隆仓库并安装依赖（前端/后端）
  - 启动基础设施（DB/Redis/MQ/MinIO）
  - 运行数据库迁移与种子数据
  - 启动后端 API 与前端

示例 docker-compose 片段（仅示意）：

```yaml
a version: '3.8'
services:
  db:
    image: postgres:16
    environment:
      POSTGRES_PASSWORD: example
    ports: ["5432:5432"]
  redis:
    image: redis:7
    ports: ["6379:6379"]
  mq:
    image: rabbitmq:3-management
    ports: ["5672:5672", "15672:15672"]
  minio:
    image: minio/minio
    command: server /data
    environment:
      MINIO_ROOT_USER: admin
      MINIO_ROOT_PASSWORD: admin123456
    ports: ["9000:9000", "9001:9001"]
```

### 3.2 生产部署

- **容器化**：前后端与 Worker 构建为独立镜像（多阶段构建，最小化体积）
- **编排**：Kubernetes + Helm（或云厂商托管 K8s），Ingress + TLS（Let’s Encrypt/云证书）
- **可用性**：副本数 >= 2，Readiness/Liveness，HPA，分区发布/金丝雀/蓝绿
- **数据**：主从或云托管（RDS），只读副本，自动备份与 PITR
- **缓存/队列**：高可用（Redis Sentinel/Cluster，MQ 镜像队列）
- **日志与指标**：集中化收集，按租户/项目维度标签化

### 3.3 CI/CD

- **流程**：lint/test/build → 安全扫描 → 镜像推送 → 部署 → 回滚策略
- **质量门禁**：单元与集成测试覆盖阈值、SAST/DAST、依赖漏洞扫描
- **迁移**：自动运行 DB Migrations（带回滚脚本）

### 3.4 安全与合规

- RBAC/ABAC，最小权限原则
- 加密：TLS in transit、KMS 加密 at rest、字段级加密（必要时）
- 审计：不可抵赖的操作日志与访问日志
- 数据策略：最小化收集、保留/删除策略、合规（GDPR/CCPA/网络安全法）

### 3.5 备份与灾备

- 数据库每日全量 + 增量日志，演练恢复
- 对象存储跨区域复制（RPO/RTO 目标）

---

## 四、里程碑与路线图（建议）

- M1（MVP）：项目/任务基础、看板、甘特、通知、基础预警、权限、报表基本版
- M2：自动化、集成（SSO/日历/Webhook）、报表增强、移动优化
- M3（AI）：延期预测、风险评分、AI 周报/任务拆分/自然语言查询

---

## 五、附录：核心数据模型（概要）

- `Project(id, name, departmentId, ownerId, status, plannedStart, plannedEnd, actualEnd, progress, completionRate, remark)`
- `Milestone(id, projectId, name, dueDate, status)`
- `Task(id, projectId, parentId, name, assigneeId, priority, status, plannedStart, plannedEnd, actualStart, actualEnd, estimateHours, spentHours, progress)`
- `TaskDependency(id, taskId, dependsOnTaskId, type)`
- `Membership(id, projectId, userId, role)`
- `Alert(id, projectId, taskId?, type, severity, message, state)`
- `Notification(id, channel, target, payload, status)`
- `ActivityLog(id, actorId, entity, action, payload)`
